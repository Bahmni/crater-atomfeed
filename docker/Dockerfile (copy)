FROM openjdk:8-alpine

ENV SERVER_PORT=8053
ENV BASE_DIR=/var/run/crater-atomfeed
ENV CONTEXT_PATH=/crater-atomfeed
ENV WAR_DIRECTORY=/var/run/crater-atomfeed/crater-atomfeed
ENV SERVER_OPTS="-Xms512m -Xmx1024m -XX:PermSize=256m -XX:MaxPermSize=512m"
ENV DEBUG_OPTS="-agentlib:jdwp=transport=dt_socket,address=8002,server=y,suspend=n"

# Used by envsubst command for replacing environment values at runtime
RUN apk add gettext

# bahmni-core.jar contains embedded tomcat server and is built from bahmni-package/core directory
COPY ./crater-atomfeed/crater-atomfeed-classes.jar /opt/crater-atomfeed/lib
COPY ./crater-atomfeed/crater-atomfeed.war /etc/crater-atomfeed

RUN mkdir -p ${WAR_DIRECTORY}
RUN cd ${WAR_DIRECTORY} && jar xvf /etc/crater-atomfeed

#COPY resources/log4j2.xml ${WAR_DIRECTORY}/WEB-INF/classes/
COPY ./templates/atomfeed.properties.template /opt/crater-atomfeed/etc/
COPY ./templates/application.properties.template /opt/crater-atomfeed/etc/
COPY ./scripts/run-liquibase.sh /opt/crater-atomfeed/etc/
RUN chmod +x /opt/crater-atomfeed/etc/run-liquibase.sh
# RUN cd ../home/beehyv/IdeaProjects/crater-atomfeed/db/hsqldb-2.6.1/hsqldb-2.6.1/hsqldb/data
# RUN ls
# RUN java -cp ../lib/hsqldb-jdk8.jar org.hsqldb.server.Server --database.0 file:testdb --dbname.0 bahmni_feed_client_example

COPY ./scripts/start.sh start.sh
RUN chmod +x start.sh
CMD [ "./start.sh" ]


